# ESP8266 网关流程

## 1.固件烧录

打开保持默认选项, 然后进行以下操作:

1. 打开 FLASH_DOWNLOAD_TOOLS 烧录工具

2. 选择串口：COM,COM3,根据自己的电脑选择

3. 擦拭Flash: 选择ERASE,按住背后按键,按键3+键#, 等一秒后松开, 等待擦拭完成

4. 写入固件：选择START,按住背后按键,按键3+键#, 等一秒后松开, 等一秒后松开, 等待烧录完成

5. 给ESP8266重新上电

## 2.程序烧写

安装 vscode 版本1.63.2, 扩展 pymakr 版本1.1.17  
> **WARNING**
注意版本需对应，否则扩展可能无法运行!

1. 设置扩展端口
在vscode页面按`Ctrl+Shift+P`，输入 pymakr， 选择 Global setting, 将 address 后的值更改成自己的电脑的串口, 然后重启 vscode，即可连接上ESP8266（命令行出显示)  

2. 打开microPytho项目目录，点击vscode下方状态栏的Upload即可即可将文件写入ESP8266,写入完成后将会自动重启ESP8266

> **WARNING** 使用 vscode 连接前请关闭烧录工具，否则串口被占用 vscode 无法连接  
> 如果控制台乱码，重启 vscode 即可

## 3.连接WiFi

第一次启动时，程序会开启热点模式, 需连接热点配置WiFi账号密码

1. 连接热点，热点名为设备名，一般以W开头+设备号, 例如：W727a9800 **WiFi密码:harmonie**

2. 打开浏览器，输入网址：[Wifi配置](http://192.168.4.1/index)

3.输入可联外网的WiFi账号密码，然后点击确

## 4.测试

网关测试可通过[腾讯云控制台物联网](https://console.cloud.tencent.com/iothub)模块进行在线调试，业务流程需要扫二维码测试  

在线调试:

1. 点击产品列表, 选择 H102L

2. 点击设备列表, 选择目标设备(网关正常运行状态为在线)，点击在线调试

3. 选择 Topic, 输入消息内容，例如：  

```json
{"cmd":"Sdlock","data":{"gateway_id":"W001000121000006","lock_mac":"E2:13:6F:BD:95:2A"},"type":1} 
```

4. 点击发送信息

5. 点击右侧的刷新实时日志即可查看网关回应消息
